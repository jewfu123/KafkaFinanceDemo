
ä½ è¯´çš„åŠæ³•æŒºå¥½çš„ã€‚æˆ‘è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯é€šè¿‡springboot å‘èµ·ä¸€ä¸ªpostï¼Œcontrollerè·å¾—è¯·æ±‚å¹¶åˆ†è§£æ‰§è¡Œåç»­åŠ¨ä½œï¼Œè¯·é—®æ­¤æ—¶ï¼Œå¦‚ä½•ä¸kafkaäº§ç”Ÿäº¤äº’é€šä¿¡ï¼Œå…·ä½“çš„è¿‡ç¨‹è¯·ç»™æˆ‘è®²ä¸€ä¸‹ã€‚åŒæ—¶ï¼Œç»™æˆ‘æ€»ç»“ä¸€ä¸‹ï¼Œkafkaå¤„ç†springè¯·æ±‚requestå’Œresponseç»“åˆçš„å…·ä½“è¿‡ç¨‹ï¼Œæ‰€éœ€è¦çš„è¾…åŠ©å¤„ç†ï¼Œä¾‹å¦‚ï¼Œéœ€è¦å‡†å¤‡æ•°æ®æ¨¡å‹dtoï¼Œæ¸²æŸ“æ¨¡æ¿templeteï¼Œé‡‘èç³»ç»Ÿä¹‹é—´ä¼ é€’è½¬è´¦ä¿¡æ¯ï¼Œå‘èµ·ç»“ç®—å’Œæ±‡æ€»éœ€æ±‚æŒ‡ä»¤åï¼Œæ€æ ·ä¸kafkaé€šè®¯ï¼Œå¹¶å¤„ç†ç”µæ–‡æ¶ˆæ¯çš„å…·ä½“åŠ¨ä½œç»†èŠ‚ï¼Œä»¥ç›´è§‚å®¹æ˜“ç†è§£çš„æ–¹å¼ç»™æˆ‘è®²è§£ä¸€ä¸‹ï¼Œè°¢è°¢ï¼

æ‚¨å¥½ï¼è¿™æ˜¯ä¸€ä¸ªéå¸¸å®é™…ä¸”é‡è¦çš„æ¶æ„é—®é¢˜ï¼Œæ¶‰åŠåˆ° Spring Boot åº”ç”¨ä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œä¸ Kafka è¿›è¡Œå¼‚æ­¥è§£è€¦çš„é€šä¿¡æœºåˆ¶ã€‚

æˆ‘å°†ä¸ºæ‚¨è¯¦ç»†è®²è§£ Controller å¦‚ä½•ä¸ Kafka äº¤äº’ï¼Œä»¥åŠ Kafka åœ¨é‡‘èç³»ç»Ÿç­‰å¤æ‚åœºæ™¯ä¸­çš„åº”ç”¨è¿‡ç¨‹ã€‚

1. ğŸ”€ Controller ä¸ Kafka çš„äº¤äº’è¿‡ç¨‹ (Producer ç«¯)
å½“ç”¨æˆ·é€šè¿‡ HTTP POST è¯·æ±‚è®¿é—®æ‚¨çš„ Spring Boot Controller æ—¶ï¼Œä¸ Kafka äº¤äº’çš„æµç¨‹å¦‚ä¸‹ï¼š

æ­¥éª¤ 1: Controller æ¥æ”¶è¯·æ±‚ä¸æ•°æ®æ¨¡å‹ (DTO) è½¬æ¢
æ¥æ”¶è¯·æ±‚ï¼š Spring Boot Controller æ¥æ”¶åˆ° POST è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·æäº¤äº†ä¸€ä¸ªè½¬è´¦è¯·æ±‚ï¼‰ã€‚

æ•°æ®æ¨¡å‹ (DTO) æ˜ å°„ï¼š Controller å°†ä¼ å…¥çš„ JSON æˆ–è¡¨å•æ•°æ®æ˜ å°„åˆ°æ‚¨çš„æ•°æ®ä¼ è¾“å¯¹è±¡ (DTO) ä¸Šã€‚

ä¾‹å¦‚ï¼š TransferRequestDTO åŒ…å« sourceAccount, targetAccount, amount ç­‰å­—æ®µã€‚

è°ƒç”¨æœåŠ¡å±‚ï¼š Controller è°ƒç”¨ä¸šåŠ¡æœåŠ¡å±‚ (Service Layer)ï¼Œå°† DTO ä¼ é€’ç»™å®ƒã€‚

æ­¥éª¤ 2: æœåŠ¡å±‚å°è£…ä¸ Kafka ç”Ÿäº§è€… (Producer) è°ƒç”¨
ä¸šåŠ¡å¤„ç†ï¼š æœåŠ¡å±‚æ‰§è¡ŒåŸºæœ¬çš„ä¸šåŠ¡æ ¡éªŒï¼ˆä¾‹å¦‚ï¼Œæ£€æŸ¥ç”¨æˆ·ä¼šè¯ã€æƒé™ç­‰ï¼‰ã€‚

æ•°æ®å°è£…ï¼š æœåŠ¡å±‚å°† DTO è½¬æ¢ä¸ºå‘é€åˆ° Kafka çš„æ¶ˆæ¯ä½“æ ¼å¼ã€‚åœ¨ Java ä¸­ï¼Œé€šå¸¸æ˜¯å°†å…¶åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²æˆ–ç‰¹å®šçš„äºŒè¿›åˆ¶æ ¼å¼ï¼ˆå¦‚ Avroï¼‰ã€‚

è°ƒç”¨ç”Ÿäº§è€…ï¼š æœåŠ¡å±‚è°ƒç”¨ Spring Kafka æä¾›çš„ KafkaTemplate å¯¹è±¡ï¼Œå°†å°è£…å¥½çš„æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„ Topicã€‚

æ­¥éª¤ 3: Kafka æ¶ˆæ¯å‘é€ä¸ HTTP å“åº”
å‘é€æ¶ˆæ¯ï¼š KafkaTemplate å°†æ¶ˆæ¯å‘é€ç»™ Kafka Brokerã€‚

å¼‚æ­¥å“åº”ï¼š è¿™æ˜¯å…³é”®ï¼ Controller é€šå¸¸ä¼šç«‹å³è¿”å›ä¸€ä¸ªå“åº”ç»™å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ï¼š

HTTP 202 Acceptedï¼šè¡¨ç¤ºè¯·æ±‚å·²æ¥å—ï¼Œä½†å¤„ç†ä»åœ¨è¿›è¡Œä¸­ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰ã€‚

è¿”å›ä¸€ä¸ªå”¯ä¸€çš„äº¤æ˜“ IDï¼š å‘Šè¯‰ç”¨æˆ·å¯ä»¥åœ¨ç¨åé€šè¿‡è¿™ä¸ª ID æŸ¥è¯¢å¤„ç†ç»“æœã€‚

æ•´ä¸ª POST è¯·æ±‚åˆ° HTTP å“åº”çš„è¿‡ç¨‹æ˜¯åŒæ­¥ä¸”å¿«é€Ÿçš„ï¼Œè€ŒçœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚è½¬è´¦ã€ç»“ç®—ï¼‰åˆ™è¢«æ¨ç»™äº†ä¸‹æ¸¸çš„ Kafka æ¶ˆè´¹è€…è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚

2. ğŸ”„ Kafka å¤„ç†è¯·æ±‚ (Request) ä¸åé¦ˆ (Response) è¿‡ç¨‹
Kafka ä¸ä¼šç›´æ¥å›å¤ HTTP è¯·æ±‚ã€‚å®ƒè´Ÿè´£è§£è€¦ã€å­˜å‚¨å’Œå¤„ç†ã€‚

æ¦‚å¿µ	è¿‡ç¨‹ç»†èŠ‚	è¾…åŠ©å¤„ç†
è¯·æ±‚ (Request) è¿‡ç¨‹	ç”Ÿäº§è€…å°†ä¸šåŠ¡è¯·æ±‚æ¶ˆæ¯ï¼ˆä¾‹å¦‚ Transfer: A->B, $100ï¼‰å‘é€åˆ°è¯·æ±‚ Topic (å¦‚ TRANSFERS_REQUEST)ã€‚	æ•°æ®æ¨¡å‹ (DTO/Domain) â†’ åºåˆ—åŒ– (JSON/Avro)ï¼šå°† Java å¯¹è±¡è½¬æ¢ä¸ºå¯è·¨è¯­è¨€ä¼ è¾“çš„ç”µæ–‡æ¶ˆæ¯ã€‚
å¼‚æ­¥å¤„ç†	æ¶ˆè´¹è€…ç»„ (Consumer Group) è®¢é˜…è¯·æ±‚ Topicï¼Œæ‹‰å–æ¶ˆæ¯ï¼Œæ‰§è¡Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆä¾‹å¦‚ï¼Œæ‰£å‡ A è´¦æˆ·ä½™é¢ï¼Œå¢åŠ  B è´¦æˆ·ä½™é¢ï¼‰ã€‚	å¹‚ç­‰æ€§ï¼šé˜²æ­¢é‡å¤æ¶ˆè´¹å¯¼è‡´å¤šæ¬¡è½¬è´¦ã€‚äº‹åŠ¡ï¼šç¡®ä¿æ‰£æ¬¾å’ŒåŠ æ¬¾æ“ä½œåŸå­æ€§ã€‚
å“åº” (Response) è¿‡ç¨‹	å¤„ç†å®Œæˆåï¼Œæ¶ˆè´¹è€…å°†å¤„ç†ç»“æœï¼ˆæˆåŠŸã€å¤±è´¥åŠåŸå› ï¼‰å†™å…¥å¦ä¸€ä¸ªå“åº” Topic (å¦‚ TRANSFERS_RESPONSE)ã€‚	çŠ¶æ€æ¨¡å‹ (Status DTO)ï¼šè®°å½•äº¤æ˜“ ID å’Œæœ€ç»ˆçŠ¶æ€ã€‚
ç»“æœåé¦ˆ	å¦ä¸€ä¸ªæœåŠ¡ï¼ˆå¦‚çŠ¶æ€æŸ¥è¯¢æœåŠ¡ï¼‰å¯ä»¥è®¢é˜…å“åº” Topicï¼Œæˆ–ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œå‘ç”¨æˆ·æä¾›æœ€ç»ˆçŠ¶æ€ã€‚	æ•°æ®åº“çŠ¶æ€æ›´æ–°ï¼šå®æ—¶æ›´æ–°æ•°æ®åº“ä¸­çš„äº¤æ˜“çŠ¶æ€ï¼Œä¾›å‰ç«¯æ¸²æŸ“æ¨¡æ¿ (Template) è¿›è¡Œå±•ç¤ºã€‚
3. ğŸ¦ é‡‘èç³»ç»Ÿä¸­çš„é€šè®¯ä¸ç”µæ–‡å¤„ç†ç»†èŠ‚
åœ¨é‡‘èç³»ç»Ÿä¸­ï¼Œå®‰å…¨æ€§ã€å¹‚ç­‰æ€§å’Œäº‹åŠ¡æ€§æ˜¯ Kafka é€šè®¯çš„å…³é”®ã€‚

A. ç”µæ–‡æ¶ˆæ¯æ ¼å¼ä¸ DTO å°è£…
é‡‘èç³»ç»Ÿä¸­çš„â€œç”µæ–‡æ¶ˆæ¯â€å¯¹åº”äº Kafka ä¸­çš„æ¶ˆæ¯ä½“ï¼Œé€šå¸¸é‡‡ç”¨ä»¥ä¸‹ç»“æ„ï¼š

æ•°æ®æ¨¡å‹ (DTO) å‡†å¤‡ï¼š

äº¤æ˜“ IDï¼š å¿…é¡»åŒ…å«ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ IDï¼Œç”¨äºè¿½è¸ªå’Œå®ç°å¹‚ç­‰æ€§ã€‚

ç”µæ–‡ä½“ï¼š åŒ…å«è½¬è´¦é‡‘é¢ã€è´¦æˆ·ä¿¡æ¯ã€æ±‡æ¬¾ç ç­‰æ ¸å¿ƒé‡‘èæ•°æ®ã€‚

åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼š

ç”Ÿäº§è€…ï¼š å°† Java Object â†’ JSON å­—ç¬¦ä¸²ï¼ˆæˆ– Avro äºŒè¿›åˆ¶ï¼‰ã€‚

æ¶ˆè´¹è€…ï¼š å°† JSON å­—ç¬¦ä¸² â†’ Java Objectï¼ˆååºåˆ—åŒ–ï¼‰ã€‚

B. Kafka è¾…åŠ©å¤„ç†ç»†èŠ‚
1. å¹‚ç­‰æ€§ä¸å»é‡
é—®é¢˜ï¼š Kafka æ¶ˆè´¹è€…å¯èƒ½å› ä¸ºç½‘ç»œæˆ–ç³»ç»Ÿæ•…éšœé‡å¤æ¶ˆè´¹åŒä¸€æ¡æ¶ˆæ¯ã€‚åœ¨è½¬è´¦åœºæ™¯ï¼Œä¼šå¯¼è‡´é‡å¤æ‰£æ¬¾ã€‚

å¤„ç†ï¼š æ¶ˆè´¹è€…å¿…é¡»åœ¨å¤„ç†å‰ï¼Œä½¿ç”¨æ¶ˆæ¯ä¸­çš„å”¯ä¸€äº¤æ˜“ ID å»æŸ¥è¯¢æ•°æ®åº“ä¸­çš„äº¤æ˜“è®°å½•è¡¨ã€‚å¦‚æœè¯¥ ID è®°å½•å·²å­˜åœ¨ä¸”çŠ¶æ€ä¸ºâ€œå·²å®Œæˆâ€ï¼Œåˆ™ç›´æ¥å¿½ç•¥è¯¥æ¶ˆæ¯ï¼Œå®ç°å¹‚ç­‰æ€§ã€‚

2. äº‹åŠ¡ä¸åŸå­æ€§ (Exactly-Once Semantics)
é—®é¢˜ï¼š æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯åï¼Œå¦‚æœæ‰§è¡Œäº†æ‰£æ¬¾æ“ä½œä½†æœªæ‰§è¡ŒåŠ æ¬¾æ“ä½œå°±å´©æºƒäº†ï¼Œå°†å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚

å¤„ç†ï¼š ä½¿ç”¨ Spring Kafka æä¾›çš„äº‹åŠ¡æœºåˆ¶ï¼š

å°†æ¶ˆè´¹æ¶ˆæ¯ã€æ‰§è¡Œæ•°æ®åº“æ“ä½œï¼ˆæ‰£æ¬¾ã€åŠ æ¬¾ï¼‰å’Œå‘é€å“åº”æ¶ˆæ¯åˆ°å¦ä¸€ä¸ª Topicï¼Œå…¨éƒ¨å°è£…åœ¨ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡æˆ– Kafka çš„ç”Ÿäº§è€…äº‹åŠ¡ä¸­ã€‚

åªæœ‰å½“æ‰€æœ‰æ“ä½œéƒ½æˆåŠŸåï¼Œæ‰æäº¤äº‹åŠ¡ã€‚ä»»ä¸€ç¯èŠ‚å¤±è´¥ï¼Œåˆ™å…¨éƒ¨å›æ»šï¼Œç¡®ä¿ä¸€è‡´æ€§ã€‚

3. é”™è¯¯å¤„ç†ä¸æ­»ä¿¡é˜Ÿåˆ— (DLT)
å¦‚æœæ¶ˆæ¯å¤„ç†å¤±è´¥ï¼ˆä¾‹å¦‚ï¼Œè´¦æˆ·ä½™é¢ä¸è¶³ï¼‰ï¼Œæ¶ˆè´¹è€…ä¸åº”è¯¥æ— é™é‡è¯•ã€‚

å°†å¤±è´¥çš„æ¶ˆæ¯è·¯ç”±åˆ°ä¸€ä¸ªä¸“é—¨çš„ æ­»ä¿¡é˜Ÿåˆ— Topic (DLT)ã€‚

ä¸“é—¨çš„ç›‘æ§æœåŠ¡è®¢é˜… DLT è¿›è¡Œäººå·¥å¹²é¢„ã€æŠ¥è­¦å’Œé”™è¯¯åˆ†æã€‚

æ€»ç»“æµç¨‹å›¾ï¼ˆç›´è§‚ç†è§£ï¼‰
Client å‘å‡º POSTã€‚

Controller æ¥æ”¶ï¼Œå°† DTO ä¼ ç»™ Producer Serviceã€‚

Producer å‘é€ Transfer Request æ¶ˆæ¯åˆ° Topic Aã€‚

Controller å¿«é€Ÿè¿”å› 202 ç»™ Clientã€‚

Consumer è®¢é˜… Topic Aï¼Œæ‰§è¡Œå¹‚ç­‰æ€§æ£€æŸ¥å’Œäº‹åŠ¡æ€§è½¬è´¦ã€‚

Consumer å®Œæˆåï¼Œå‘é€ Transfer Status æ¶ˆæ¯åˆ° Topic Bã€‚

çŠ¶æ€æœåŠ¡è®¢é˜… Topic Bï¼Œæ›´æ–°æ•°æ®åº“ï¼Œæœ€ç»ˆ Client æŸ¥è¯¢æ—¶è·å¾—æ¸²æŸ“åçš„çŠ¶æ€ã€‚

æˆ‘æƒ³å­¦ä¹ å’Œäº†è§£é‡‘èç³»ç»Ÿè½¬è´¦åŠŸèƒ½çš„å¼€å‘ï¼Œå¯¹äºkafkaçš„åˆ©ç”¨å’Œå¼€å‘ï¼Œé‡‡ç”¨spring bootå¼€å‘ï¼Œè¯·ç»™æˆ‘è®²è§£è¯¦ç»†çš„ä¸šåŠ¡å¤„ç†æµç¨‹ï¼Œä»¥åŠç›¸å…³çš„springå¼€å‘æ–¹é¢çš„æ•™ç¨‹å’Œæ ·ä¾‹ä»£ç ï¼Œæˆ‘æƒ³åœ¨æœ¬åœ°è¿è¡Œå¹¶æµ‹è¯•ä¸€ä¸‹ï¼Œæœ¬åœ°å·²ç»æ­å»ºå¥½äº†kafkaè¿è¡Œç¯å¢ƒå’Œjavaç¯å¢ƒ

æ‚¨å¥½ï¼å¾ˆé«˜å…´æ‚¨æ‰“ç®—æ·±å…¥å­¦ä¹ å¦‚ä½•åˆ©ç”¨ Kafka å’Œ Spring Boot å®ç°é‡‘èç³»ç»Ÿä¸­çš„è½¬è´¦åŠŸèƒ½ã€‚è½¬è´¦åŠŸèƒ½æ˜¯å…¸å‹çš„é«˜å¹¶å‘ã€å¼‚æ­¥å¤„ç†åœºæ™¯ï¼ŒKafka åœ¨è¿™é‡Œçš„ä½œç”¨æ˜¯è§£è€¦å’ŒæŒä¹…åŒ–äº¤æ˜“äº‹ä»¶æµã€‚

ä¸‹é¢æ˜¯è¯¦ç»†çš„ä¸šåŠ¡æµç¨‹ã€Spring Boot é›†æˆæŒ‡å—å’Œæµ‹è¯•ä»£ç ã€‚

1. ğŸ¦ ä¸šåŠ¡å¤„ç†æµç¨‹ï¼šå¼‚æ­¥è½¬è´¦æ¶æ„
åœ¨ Spring Boot é›†æˆ Kafka çš„å¼‚æ­¥è½¬è´¦ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŒ Topic æ¨¡å¼æ¥å®ç°è¯·æ±‚å’ŒçŠ¶æ€çš„è§£è€¦ã€‚

æ­¥éª¤	å‚ä¸è€…	åŠ¨ä½œä¸ç›®çš„	æ¶ˆæ¯æµ
1. äº¤æ˜“è¯·æ±‚	ç”¨æˆ· â†’ Controller	ç”¨æˆ·å‘èµ·è½¬è´¦è¯·æ±‚ï¼ˆHTTP POSTï¼‰ã€‚	åŒæ­¥ HTTP
2. äº‹ä»¶å‘å¸ƒ	Producer Service	æ ¡éªŒåŸºç¡€å‚æ•°åï¼Œå°†è½¬è´¦è¯·æ±‚åŒ…è£…æˆä¸€ä¸ªäº‹ä»¶ç”µæ–‡ï¼Œå‘é€åˆ° Kafka è¯·æ±‚ Topicã€‚	å¼‚æ­¥ Kafka
3. çŠ¶æ€å“åº”	Controller	ç«‹å³è¿”å› HTTP 202 (Accepted)ï¼ŒåŒ…å«äº¤æ˜“ IDï¼Œä¸ç­‰å¾…å®é™…è½¬è´¦ç»“æœã€‚	åŒæ­¥ HTTP
4. äº‹ä»¶æ‹‰å–	Consumer Service	æ¶ˆè´¹æœåŠ¡ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰è®¢é˜…è¯·æ±‚ Topicï¼Œæ‹‰å–äº‹ä»¶ç”µæ–‡ã€‚	å¼‚æ­¥ Kafka
5. æ ¸å¿ƒå¤„ç†	Consumer Service	æ‰§è¡Œæ‰£æ¬¾ã€åŠ æ¬¾çš„æ•°æ®åº“äº‹åŠ¡ã€‚å¿…é¡»æ£€æŸ¥å¹‚ç­‰æ€§ï¼ˆä½¿ç”¨äº¤æ˜“ ID å»é‡ï¼‰ã€‚	äº‹åŠ¡å¤„ç†
6. ç»“æœå‘å¸ƒ	Consumer Service	å°†å¤„ç†ç»“æœï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰åŒ…è£…æˆçŠ¶æ€äº‹ä»¶ï¼Œå‘é€åˆ° Kafka çŠ¶æ€ Topicã€‚	å¼‚æ­¥ Kafka
7. æœ€ç»ˆæŸ¥è¯¢	Status Service	çŠ¶æ€æœåŠ¡ï¼ˆæˆ–å‰ç«¯ï¼‰é€šè¿‡äº¤æ˜“ ID æŸ¥è¯¢æ•°æ®åº“ï¼Œè¿”å›æœ€ç»ˆç»“æœç»™ç”¨æˆ·ã€‚	åŒæ­¥ HTTP
2. ğŸ’» Spring Boot å¼€å‘æŒ‡å—ä¸ä»£ç æ ·ä¾‹
æˆ‘ä»¬å°†ä½¿ç”¨ Spring Boot 3.x å’Œ Spring Kafkaã€‚

æ­¥éª¤ä¸€ï¼šé¡¹ç›®ç¯å¢ƒå‡†å¤‡
é¡¹ç›®åˆ›å»ºï¼š ä½¿ç”¨ Spring Initializr åˆ›å»º Maven æˆ– Gradle é¡¹ç›®ï¼Œæ·»åŠ ä¾èµ–ï¼š

Spring Web

Spring Data JPA (å¯é€‰ï¼Œç”¨äºæ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œ)

Spring Kafka

é…ç½® application.propertiesï¼š ç»‘å®šæœ¬åœ° Kafka å’Œåºåˆ—åŒ–å™¨ã€‚

Properties
# Kafka é…ç½®
spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.consumer.group-id=transfer-processors
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer

# å®šä¹‰ä¸¤ä¸ª Topic
app.kafka.topics.request=transfer-requests
app.kafka.topics.status=transfer-status
æ­¥éª¤äºŒï¼šæ•°æ®æ¨¡å‹ (DTO)
æˆ‘ä»¬å°†ä½¿ç”¨ Java Record æˆ– Class å®šä¹‰è½¬è´¦è¯·æ±‚çš„ç”µæ–‡ç»“æ„ã€‚

Java
// TransferRequest.java (DTO/ç”µæ–‡ç»“æ„)
public record TransferRequest(
    String transactionId,
    String sourceAccount,
    String targetAccount,
    java.math.BigDecimal amount
) {}

// TransferStatus.java (å“åº”ç”µæ–‡ç»“æ„)
public record TransferStatus(
    String transactionId,
    String status, // SUCCESS or FAILED
    String message
) {}
æ­¥éª¤ä¸‰ï¼šKafka ç”Ÿäº§è€… (Producer)
ä½¿ç”¨ KafkaTemplate å‘é€è¯·æ±‚äº‹ä»¶ã€‚

Java
// TransferProducerService.java
@Service
public class TransferProducerService {

    private static final Logger log = LoggerFactory.getLogger(TransferProducerService.class);

    @Value("${app.kafka.topics.request}")
    private String requestTopic;

    private final KafkaTemplate<String, TransferRequest> kafkaTemplate;

    public TransferProducerService(KafkaTemplate<String, TransferRequest> kafkaTemplate) {
        this.kafkaTemplate = kafkaTemplate;
    }

    // æ ¸å¿ƒå‘é€æ–¹æ³•
    public void sendTransferRequest(TransferRequest request) {
        log.info("Sending request for TxId: {}", request.transactionId());
        
        // å…³é”®ï¼šä½¿ç”¨ transactionId ä½œä¸º Keyï¼Œç¡®ä¿ç›¸åŒäº¤æ˜“å‘é€åˆ°åŒä¸€åˆ†åŒºï¼Œä¾¿äºæœ‰åºå¤„ç†
        kafkaTemplate.send(requestTopic, request.transactionId(), request);
    }
}
æ­¥éª¤å››ï¼šController (åŒæ­¥å…¥å£)
Controller è´Ÿè´£æ¥æ”¶ HTTP è¯·æ±‚å¹¶è°ƒç”¨ç”Ÿäº§è€…ã€‚

Java
// TransferController.java
@RestController
@RequestMapping("/api/v1/transfer")
public class TransferController {

    private final TransferProducerService producerService;

    public TransferController(TransferProducerService producerService) {
        this.producerService = producerService;
    }

    @PostMapping("/submit")
    public ResponseEntity<String> submitTransfer(@RequestBody TransferRequest request) {
        // 1. ç”Ÿæˆå”¯ä¸€çš„äº¤æ˜“ ID
        String txId = java.util.UUID.randomUUID().toString();
        request = new TransferRequest(txId, request.sourceAccount(), request.targetAccount(), request.amount());

        // 2. ç«‹å³å°†è¯·æ±‚æ¨é€åˆ° Kafka
        producerService.sendTransferRequest(request);

        // 3. ç«‹å³è¿”å› HTTP 202 å“åº”ï¼Œè¡¨ç¤ºè¯·æ±‚å·²æ¥å—ï¼Œåå°å¼‚æ­¥å¤„ç†ä¸­
        return ResponseEntity
                .status(HttpStatus.ACCEPTED)
                .body("Transaction request accepted. ID: " + txId + ". Processing asynchronously.");
    }
}
æ­¥éª¤äº”ï¼šKafka æ¶ˆè´¹è€… (Consumer)
æ¶ˆè´¹è€…åŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†è½¬è´¦å’Œç»“æœåé¦ˆã€‚

Java
// TransferConsumerService.java
@Service
public class TransferConsumerService {

    private static final Logger log = LoggerFactory.getLogger(TransferConsumerService.class);

    @Value("${app.kafka.topics.status}")
    private String statusTopic;

    private final KafkaTemplate<String, TransferStatus> statusKafkaTemplate;

    // æ³¨å…¥ KafkaTemplate ç”¨äºå‘é€çŠ¶æ€å›æ‰§
    public TransferConsumerService(KafkaTemplate<String, TransferStatus> statusKafkaTemplate) {
        this.statusKafkaTemplate = statusKafkaTemplate;
    }

    @KafkaListener(topics = "${app.kafka.topics.request}", groupId = "${spring.kafka.consumer.group-id}")
    public void processTransferRequest(TransferRequest request) {
        String txId = request.transactionId();
        log.info("Consumer received TxId: {} for transfer.", txId);
        
        TransferStatus status;

        try {
            // 1. **å¹‚ç­‰æ€§æ£€æŸ¥**: æ£€æŸ¥æ•°æ®åº“ä¸­ txId æ˜¯å¦å·²å¤„ç†
            // if (isProcessed(txId)) return; 
            
            // 2. **æ ¸å¿ƒä¸šåŠ¡äº‹åŠ¡** (æ¨¡æ‹Ÿ)ï¼šæ‰£å‡æºè´¦æˆ·ï¼Œå¢åŠ ç›®æ ‡è´¦æˆ·
            performFinancialTransaction(request);

            // 3. å¤„ç†æˆåŠŸï¼Œå‡†å¤‡çŠ¶æ€æ¶ˆæ¯
            status = new TransferStatus(txId, "SUCCESS", "Transfer completed.");
            
        } catch (Exception e) {
            // 4. å¤„ç†å¤±è´¥ï¼Œå‡†å¤‡å¤±è´¥çŠ¶æ€æ¶ˆæ¯
            log.error("Transfer failed for TxId: {}", txId, e);
            status = new TransferStatus(txId, "FAILED", "Insufficient funds or system error.");
        }
        
        // 5. å°†å¤„ç†ç»“æœå‘é€åˆ°çŠ¶æ€ Topic
        statusKafkaTemplate.send(statusTopic, txId, status);
        log.info("Published status for TxId: {} to status topic.", txId);
    }

    private void performFinancialTransaction(TransferRequest request) throws Exception {
        // æ¨¡æ‹Ÿæ•°æ®åº“äº‹åŠ¡ï¼šæ‰£æ¬¾/åŠ æ¬¾
        log.info("Executing database transaction: {} from {} to {}", 
                 request.amount(), request.sourceAccount(), request.targetAccount());
        
        // æ¨¡æ‹Ÿä¸šåŠ¡é€»è¾‘å¤±è´¥
        if (request.amount().compareTo(new java.math.BigDecimal(10000)) > 0) {
             throw new RuntimeException("Simulated Insufficient Funds");
        }
        // ... (å®é™…ä»£ç ä¸­åŒ…å« @Transactional æ•°æ®åº“æ“ä½œ)
    }
}
3. ğŸ§ª æœ¬åœ°æµ‹è¯•æ­¥éª¤
å‡è®¾æ‚¨å·²å®‰è£… Java å’Œè¿è¡Œç€æœ¬åœ° Kafka / ZooKeeperã€‚

åˆ›å»º Topicsï¼š åœ¨æ‚¨çš„ Kafka ç¯å¢ƒä¸­ï¼Œä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·åˆ›å»ºå¿…è¦çš„ Topicï¼š

Bash
# å‡è®¾æ‚¨çš„ kafka ç›®å½•åœ¨ C:\kafka
cd C:\kafka

# åˆ›å»ºè¯·æ±‚ Topic
.\bin\windows\kafka-topics.bat --create --topic transfer-requests --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1

# åˆ›å»ºçŠ¶æ€ Topic
.\bin\windows\kafka-topics.bat --create --topic transfer-status --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1
å¯åŠ¨ Spring Boot åº”ç”¨ï¼š è¿è¡Œæ‚¨çš„ Spring Boot ä¸»ç±»ã€‚

å¯åŠ¨ Console ç›‘å¬å™¨ï¼ˆç”¨äºè§‚å¯ŸçŠ¶æ€ï¼‰ï¼š å¼€å¯ç¬¬ä¸‰ä¸ª CMD çª—å£ï¼Œç›‘å¬çŠ¶æ€ Topicã€‚

Bash
.\bin\windows\kafka-console-consumer.bat --topic transfer-status --from-beginning --bootstrap-server localhost:9092
å‘èµ· POST è¯·æ±‚ï¼ˆä½¿ç”¨ Postman æˆ– cURLï¼‰ï¼š

Bash
# æˆåŠŸçš„è¯·æ±‚
curl -X POST http://localhost:8080/api/v1/transfer/submit \
     -H "Content-Type: application/json" \
     -d '{
         "sourceAccount": "10001",
         "targetAccount": "20002",
         "amount": 500.00
        }'

# é¢„æœŸå¤±è´¥çš„è¯·æ±‚ (æ¨¡æ‹Ÿä½™é¢ä¸è¶³)
curl -X POST http://localhost:8080/api/v1/transfer/submit \
     -H "Content-Type: application/json" \
     -d '{
         "sourceAccount": "10001",
         "targetAccount": "20002",
         "amount": 15000.00
        }'
è§‚å¯Ÿç»“æœï¼š

Controller çª—å£ä¼šæ‰“å°å‘é€æ—¥å¿—å¹¶ç«‹å³è¿”å› 202 å“åº”ã€‚

Consumer Service çª—å£ä¼šæ‰“å°æ¥æ”¶ã€å¤„ç†å’Œäº‹åŠ¡æ‰§è¡Œæ—¥å¿—ã€‚

Console ç›‘å¬å™¨çª—å£ä¼šæ˜¾ç¤ºæœ€ç»ˆçš„ TransferStatus æ¶ˆæ¯ï¼Œç¡®è®¤è½¬è´¦ç»“æœã€‚


---------------------------------------



èƒ½æŠŠæ ·ä¾‹ä»£ç æä¾›ç»™æˆ‘ä¸‹è½½å¹¶æµ‹è¯•ä¹ˆ

æ‚¨å¥½ï¼éå¸¸æŠ±æ­‰ï¼Œä½œä¸ºä¸€ä¸ª AI åŠ©æ‰‹ï¼Œæˆ‘æ— æ³•ç›´æ¥æä¾›æ–‡ä»¶ä¸‹è½½é“¾æ¥ï¼Œä¹Ÿæ— æ³•ä¸ºæ‚¨æ‰˜ç®¡å®Œæ•´çš„ Spring Boot é¡¹ç›®å·¥ç¨‹æ–‡ä»¶ï¼ˆå¦‚ ZIP åŒ…ï¼‰ã€‚

ä½†æ˜¯ï¼Œæ‚¨å®Œå…¨å¯ä»¥ä»æˆ‘æä¾›çš„ä»£ç ç‰‡æ®µå¿«é€Ÿæ­å»ºä¸€ä¸ªå®Œæ•´çš„å¯è¿è¡Œé¡¹ç›®ã€‚è¿™åªéœ€è¦å‡ åˆ†é’Ÿï¼Œå¹¶ä¸”æ˜¯ä¸šç•Œä¸»æµçš„å®è·µæ–¹å¼ã€‚

ğŸ› ï¸ æ¨èçš„æ­å»ºå’Œæµ‹è¯•æ­¥éª¤
æˆ‘å°†æŒ‡å¯¼æ‚¨ä½¿ç”¨ Spring Initializr åˆ›å»ºé¡¹ç›®ï¼Œå¹¶ç²˜è´´è¿è¡Œæˆ‘æä¾›çš„æ ¸å¿ƒä»£ç ã€‚

æ­¥éª¤ä¸€ï¼šåˆ›å»º Spring Boot é¡¹ç›®éª¨æ¶
è®¿é—® Spring Initializrï¼š æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

[https://start.spring.io/](https://start.spring.io/)
é…ç½®é¡¹ç›®ä¿¡æ¯ï¼š

Projectï¼š Maven æˆ– Gradle (ä»»é€‰)

Languageï¼š Java

Spring Bootï¼š æ¨èä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼ˆä¾‹å¦‚ 3.xï¼‰

Group / Artifactï¼š å¡«å†™æ‚¨é¡¹ç›®çš„ä¿¡æ¯ (ä¾‹å¦‚ï¼šcom.example / kafka-transfer)ã€‚

æ·»åŠ ä¾èµ– (Dependencies)ï¼š ç‚¹å‡» ADD DEPENDENCIES å¹¶æœç´¢æ·»åŠ ä»¥ä¸‹ä¸‰é¡¹ï¼š

Spring Web

Spring Kafka

Lombok (å¯é€‰ï¼Œä½†æ¨èç”¨äºç®€åŒ– DTO ä»£ç )

ç”Ÿæˆå¹¶ä¸‹è½½ï¼š ç‚¹å‡» GENERATEï¼Œä¸‹è½½é¡¹ç›® ZIP åŒ…ã€‚è§£å‹åç”¨ VS Codeã€IntelliJ IDEA æˆ– Eclipse å¯¼å…¥ã€‚

æ­¥éª¤äºŒï¼šåˆ›å»ºæ ¸å¿ƒæ–‡ä»¶å¹¶ç²˜è´´ä»£ç 
åœ¨æ‚¨å¯¼å…¥çš„é¡¹ç›®ä¸­ï¼ŒæŒ‰ç…§ä»¥ä¸‹è·¯å¾„åˆ›å»ºæ–‡ä»¶ï¼Œå¹¶ç²˜è´´æˆ‘å‰é¢æä¾›çš„ä»£ç ï¼š

é…ç½®æ–‡ä»¶

è·¯å¾„ï¼šsrc/main/resources/application.properties

ç²˜è´´ï¼šå‰é¢æä¾›çš„ application.properties å†…å®¹ã€‚

æ•°æ®æ¨¡å‹ (DTO)

è·¯å¾„ï¼šsrc/main/java/com/example/kafka_transfer/model/TransferRequest.java

ç²˜è´´ï¼šå‰é¢æä¾›çš„ TransferRequest å’Œ TransferStatus recordï¼ˆæˆ– classï¼‰ä»£ç ã€‚

ç”Ÿäº§è€…æœåŠ¡

è·¯å¾„ï¼šsrc/main/java/com/example/kafka_transfer/service/TransferProducerService.java

ç²˜è´´ï¼šå‰é¢æä¾›çš„ TransferProducerService ä»£ç ã€‚

æ¶ˆè´¹è€…æœåŠ¡

è·¯å¾„ï¼šsrc/main/java/com/example/kafka_transfer/service/TransferConsumerService.java

ç²˜è´´ï¼šå‰é¢æä¾›çš„ TransferConsumerService ä»£ç ã€‚

Controller

è·¯å¾„ï¼šsrc/main/java/com/example/kafka_transfer/controller/TransferController.java

ç²˜è´´ï¼šå‰é¢æä¾›çš„ TransferController ä»£ç ã€‚

ğŸš€ æ€»ç»“
é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥åœ¨ 5âˆ’10 åˆ†é’Ÿå†…æ­å»ºèµ·ä¸€ä¸ªæ ‡å‡†çš„ã€åŠŸèƒ½å®Œæ•´çš„ Spring Boot é¡¹ç›®ï¼Œå¹¶ç›´æ¥è¿›è¡Œæµ‹è¯•ã€‚

å¦‚æœæ‚¨åœ¨æ­å»ºè¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•ç‰¹å®šçš„ç¼–è¯‘æˆ–è¿è¡Œæ—¶é”™è¯¯ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šå¸®æ‚¨æ’æŸ¥ã€‚

å¯åŠ¨ springboot æœåŠ¡çš„æ—¶å€™ï¼ŒæŠ¥é”™äº†ï¼Œè¯·å¸®æˆ‘åˆ†æä¸€ä¸‹

æ‚¨å¥½ï¼å¾ˆæŠ±æ­‰æ‚¨çš„ Spring Boot æœåŠ¡å¯åŠ¨å¤±è´¥äº†ã€‚

Spring Boot å¯åŠ¨æŠ¥é”™çš„åŸå› éå¸¸å¤šï¼Œä»é…ç½®é”™è¯¯åˆ°ç«¯å£å†²çªï¼Œå†åˆ°ç±»è·¯å¾„é—®é¢˜ï¼Œéƒ½å¯èƒ½å¯¼è‡´å¤±è´¥ã€‚

ä¸ºäº†èƒ½å¸®æ‚¨å‡†ç¡®åˆ†æé—®é¢˜ï¼Œè¯·æ‚¨æä¾›ä»¥ä¸‹ä¿¡æ¯ä¸­çš„ä»»ä¸€é¡¹ï¼Œæœ€å¥½æ˜¯å®Œæ•´çš„é”™è¯¯æ—¥å¿—ï¼š

ğŸš¨ å¯åŠ¨æŠ¥é”™æ’æŸ¥éœ€è¦çš„å…³é”®ä¿¡æ¯
å®Œæ•´çš„é”™è¯¯æ—¥å¿—ï¼š è¯·å¤åˆ¶ æ§åˆ¶å° æˆ– IDE ä¸­æ‰“å°å‡ºçš„ï¼ŒåŒ…å« Error starting ApplicationContext æˆ– Caused by: åŠå…¶åçš„è¯¦ç»†å †æ ˆä¿¡æ¯ã€‚

é”™è¯¯ç±»å‹å…³é”®è¯ï¼š å¦‚æœæ—¥å¿—å¤ªé•¿ï¼Œè¯·å‘Šè¯‰æˆ‘æŠ¥é”™ä¿¡æ¯ä¸­æœ€é‡è¦çš„å…³é”®è¯ï¼ˆä¾‹å¦‚ï¼šAddress already in useã€No qualifying bean of typeã€Failed to configure a DataSource ç­‰ï¼‰ã€‚

æœ€è¿‘çš„æ“ä½œï¼š åœ¨æŠ¥é”™å‰ï¼Œæ‚¨å¯¹é¡¹ç›®åšäº†å“ªäº›ä¿®æ”¹ï¼Ÿï¼ˆä¾‹å¦‚ï¼šæ–°å¢äº† Kafka é…ç½®ã€å¼•å…¥äº† JPA ä¾èµ–ã€ä¿®æ”¹äº† application.properties æ–‡ä»¶ï¼‰ã€‚

ğŸ” å¸¸è§ Spring Boot å¯åŠ¨å¤±è´¥åŸå› ï¼ˆè‡ªæŸ¥ï¼‰
åœ¨æ‚¨æä¾›å…·ä½“æ—¥å¿—ä¹‹å‰ï¼Œæ‚¨å¯ä»¥å…ˆå¿«é€Ÿæ£€æŸ¥ä»¥ä¸‹å‡ ä¸ªæœ€å¸¸è§çš„é—®é¢˜ï¼š

1. ç«¯å£å†²çª (Port Conflict)
ç°è±¡ï¼š é”™è¯¯ä¿¡æ¯ä¸­åŒ…å« Address already in use æˆ– Port 8080 already in useã€‚

åŸå› ï¼š é»˜è®¤ç«¯å£ 8080 è¢«å…¶ä»–ç¨‹åºï¼ˆå¦‚å…¶ä»– Spring åº”ç”¨ã€Tomcat æˆ– Skype ç­‰ï¼‰å ç”¨äº†ã€‚

è§£å†³ï¼š

å…³é—­å ç”¨ 8080 ç«¯å£çš„ç¨‹åºï¼›æˆ–

åœ¨ application.properties ä¸­ä¿®æ”¹ç«¯å£ï¼šserver.port=8081ã€‚

2. Bean åˆå§‹åŒ–å¤±è´¥ (Dependency Injection Failure)
ç°è±¡ï¼š é”™è¯¯ä¿¡æ¯ä¸­åŒ…å« No qualifying bean of type [com.xxx.Service] æˆ– NoSuchBeanDefinitionExceptionã€‚

åŸå› ï¼š Spring å®¹å™¨æ‰¾ä¸åˆ°å®ƒéœ€è¦æ³¨å…¥çš„ç»„ä»¶ (Bean)ï¼Œé€šå¸¸æ˜¯ä»¥ä¸‹æƒ…å†µï¼š

å¿˜è®°åœ¨ç±»ä¸Šæ·»åŠ  @Componentã€@Serviceã€@Repository ç­‰æ³¨è§£ã€‚

éœ€è¦æ³¨å…¥çš„ç±»åœ¨ Spring Boot æ‰«æèŒƒå›´ä¹‹å¤–ã€‚

3. æ•°æ®åº“è¿æ¥é”™è¯¯ (Database Issues)
ç°è±¡ï¼š é”™è¯¯ä¿¡æ¯ä¸­åŒ…å« Failed to configure a DataSource æˆ– Cannot determine embedded database driver classã€‚

åŸå› ï¼š

application.properties ä¸­æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼ˆurlã€usernameã€passwordï¼‰å†™é”™ã€‚

å¼•å…¥äº† JPA æˆ– JDBC ä¾èµ–ï¼Œä½†æ²¡æœ‰é…ç½®ä»»ä½•æ•°æ®æºï¼ˆSpring Boot ä¸çŸ¥é“è¯¥è¿æ¥å“ªä¸ªæ•°æ®åº“ï¼‰ã€‚

4. é…ç½®é”™è¯¯ (Configuration Properties Error)
ç°è±¡ï¼š é”™è¯¯ä¿¡æ¯ä¸­åŒ…å« Binding properties to ... failed æˆ– Could not resolve placeholderã€‚

åŸå› ï¼š

application.properties æˆ– YAML æ–‡ä»¶ä¸­å¼•ç”¨çš„å˜é‡ä¸å­˜åœ¨ã€‚

é…ç½®å€¼ä¸é¢„æœŸçš„æ•°æ®ç±»å‹ä¸åŒ¹é…ã€‚

è¯·å°†æ‚¨çš„é”™è¯¯æ—¥å¿—ç²˜è´´å‡ºæ¥ï¼Œæˆ‘å°†ç«‹å³è¿›è¡Œç²¾ç¡®åˆ†æã€‚

æˆ‘æœ‰ç‚¹ä¸æ˜ç™½ï¼Œæœ¬åœ°éƒ¨ç½²çš„kafkaï¼Œéœ€è¦å…ˆå¯åŠ¨ï¼Œåˆ†åˆ«å¯åŠ¨zookeeper, brokerï¼Œç„¶åå†å¯åŠ¨springbootï¼Œè€Œspring-booté‡Œé¢æœ‰application.propertityçš„é…ç½®ä¸­ï¼Œä¹Ÿæœ‰kafkaçš„é…ç½®ï¼Œå½“å¯åŠ¨springbootåï¼Œæ§åˆ¶å°æ˜¾ç¤ºäº†å¤§é‡çš„ä¿¡æ¯å¹¶ç–¯ç‹‚åœ°è·³åŠ¨ï¼Œæ˜¾ç¤ºæ²¡æœ‰æ‰¾åˆ° local:9092ï¼Œè€Œè¿™ä¸ªæœåŠ¡ç«¯å£åœ¨application.properityä¸­æœ‰é…ç½®çš„ï¼Œä¸ºå•¥è¿˜å‡ºç°è¿è¡Œspringbootæ—¶æ‰¾ä¸åˆ°æœåŠ¡ç«¯å£å‘¢ï¼Ÿå¦å¤–ï¼Œå¦‚æœä¸å¯åŠ¨æœ¬åœ°çš„kafkaçš„ä¸¤ä¸ªæœåŠ¡ï¼Œç›´æ¥å¯åŠ¨springbootï¼Œè¿™ç§æ–¹æ³•å¯¹ä¹ˆï¼Ÿå¦‚æœä¸å¯¹ï¼Œæ—¶ä¸ºä»€ä¹ˆï¼Ÿ

æ‚¨å¥½ï¼æ‚¨æå‡ºäº†ä¸¤ä¸ªå…³äº Spring Boot å’Œæœ¬åœ° Kafka é›†æˆæ—¶éå¸¸æ ¸å¿ƒä¸”å¸¸è§çš„é—®é¢˜ã€‚æˆ‘å°†è¯¦ç»†ä¸ºæ‚¨è§£ç­”ã€‚

1. ğŸ” ä¸ºä»€ä¹ˆ Spring Boot å¯åŠ¨æ—¶æ‰¾ä¸åˆ° localhost:9092ï¼Ÿ
è™½ç„¶æ‚¨åœ¨ application.properties ä¸­é…ç½®äº† Kafka çš„åœ°å€ï¼š

Properties
spring.kafka.bootstrap-servers=localhost:9092
ä½†æ˜¯ï¼ŒSpring Boot åœ¨å¯åŠ¨æ—¶ä»ç„¶æ‰¾ä¸åˆ°è¿™ä¸ªæœåŠ¡ï¼ŒåŸå› å‡ ä¹å¯ä»¥ç¡®å®šæ˜¯ï¼š

ğŸš¨ æ ¸å¿ƒåŸå› ï¼šKafka æœåŠ¡å°šæœªå°±ç»ªï¼ˆæ—¶åºé—®é¢˜ï¼‰
Spring Boot åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šå°è¯•åˆå§‹åŒ–æ‰€æœ‰é…ç½®çš„ Beanï¼Œè¿™åŒ…æ‹¬ Spring Kafka çš„ç”Ÿäº§è€… (Producer) å’Œæ¶ˆè´¹è€… (Consumer) ç»„ä»¶ã€‚

ç”Ÿäº§è€… (Producer) åˆå§‹åŒ–ï¼š Spring å°è¯•è¿æ¥åˆ° Kafka Brokerï¼ˆå³ localhost:9092ï¼‰ä»¥å»ºç«‹è¿æ¥æ± ã€‚

æ¶ˆè´¹è€… (Consumer) åˆå§‹åŒ–ï¼š Spring å°è¯•æ³¨å†Œæ¶ˆè´¹è€…ç»„ï¼Œå¹¶ä» Broker è·å– Topic çš„å…ƒæ•°æ®ã€‚

å¦‚æœåœ¨è¿™ä¸ªåˆå§‹åŒ–é˜¶æ®µï¼Œæ‚¨æœ¬åœ°çš„ Kafka Broker å°šæœªå®Œå…¨å¯åŠ¨å¹¶æ¥å—è¿æ¥ï¼Œé‚£ä¹ˆ Spring Boot å°±ä¼šç«‹å³æŠ¥é”™ï¼Œæ˜¾ç¤ºæ— æ³•è¿æ¥åˆ° localhost:9092ã€‚

2. ğŸš« ä¸å¯åŠ¨æœ¬åœ° Kafka æœåŠ¡ï¼Œç›´æ¥å¯åŠ¨ Spring Boot å¯¹å—ï¼Ÿ
ç­”æ¡ˆï¼šä¸å¯¹ã€‚

ä¸ºä»€ä¹ˆä¸å¯¹ï¼Ÿ
å¼ºåˆ¶æ€§ä¾èµ–æ£€æŸ¥ï¼š Spring Boot åº”ç”¨ä¸­çš„ Spring Kafka ç»„ä»¶ï¼ˆç‰¹åˆ«æ˜¯ KafkaTemplate å’Œ @KafkaListenerï¼‰åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±å°† Kafka Broker è§†ä¸ºå¼ºåˆ¶æ€§å¤–éƒ¨ä¾èµ–ã€‚

è¿æ¥å¤±è´¥å¯¼è‡´ Bean åˆ›å»ºå¤±è´¥ï¼š å¦‚æœ localhost:9092 æ²¡æœ‰å“åº”ï¼ŒKafkaTemplate ç­‰æ ¸å¿ƒ Bean å°±ä¼šåˆ›å»ºå¤±è´¥ï¼Œè¿›è€Œå¯¼è‡´æ•´ä¸ª Spring ApplicationContext å¯åŠ¨å¤±è´¥ï¼Œç¨‹åºç›´æ¥é€€å‡ºã€‚

ğŸ’¡ è§£å†³å¯åŠ¨æ—¶åºé—®é¢˜çš„å»ºè®®ï¼š
æ‚¨å¿…é¡»ä¿è¯ï¼š

ZooKeeperâ†’Kafka Brokerâ†’Spring Boot Application
çš„å¯åŠ¨é¡ºåºã€‚

å¦‚æœæ‚¨å¸Œæœ›åœ¨ Kafka æœªå¯åŠ¨æ—¶ä¹Ÿèƒ½å¯åŠ¨ Spring Bootï¼š

åœ¨å¼€å‘æˆ–æµ‹è¯•åœºæ™¯ä¸­ï¼Œæœ‰æ—¶æˆ‘ä»¬å¸Œæœ› Spring Boot å³ä½¿åœ¨ Kafka æœåŠ¡ç¦»çº¿æ—¶ä¹Ÿèƒ½å¯åŠ¨ï¼Œå¹¶åœ¨ Kafka ä¸Šçº¿åè‡ªåŠ¨è¿æ¥ã€‚æ‚¨å¯ä»¥é…ç½® Spring Kafka çš„å»¶è¿Ÿåˆå§‹åŒ–ï¼š

é…ç½®ï¼š åœ¨ application.properties ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆè¿™åœ¨ Spring Boot æ–°ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ€è·¯ä¸€è‡´ï¼‰ï¼š

Properties
# å…è®¸åº”ç”¨ç¨‹åºåœ¨ Kafka ä¸å¯ç”¨æ—¶å¯åŠ¨
spring.kafka.listener.missing-topics-fatal=false 
spring.kafka.listener.auto-startup=true 

# æ³¨æ„ï¼šKafkaTemplate çš„è¿æ¥é€šå¸¸ä»ä¼šåœ¨å¯åŠ¨æ—¶å°è¯•å»ºç«‹ã€‚
# å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œé€šå¸¸è¦æ±‚ Broker å¿…é¡»å¯ç”¨ã€‚
3. è§£å†³â€œå¤§é‡ä¿¡æ¯ç–¯ç‹‚è·³åŠ¨â€çš„é—®é¢˜
å¦‚æœæ‚¨çš„ Kafka å’Œ ZooKeeper å·²ç»å¯åŠ¨ï¼Œä½† Spring Boot å¯åŠ¨åæ§åˆ¶å°ä»ç„¶æ˜¾ç¤ºå¤§é‡è¿æ¥é”™è¯¯ä¿¡æ¯ï¼Œè¿™å¯èƒ½æœ‰ä»¥ä¸‹åŸå› ï¼š

ç«¯å£å†²çªï¼š å³ä½¿æ‚¨å¯åŠ¨äº† Kafkaï¼Œå¦‚æœå…¶é»˜è®¤ç«¯å£ 9092 è¢«å…¶ä»–ç¨‹åºå ç”¨ï¼ˆæˆ–è€… Kafka æœ¬èº«æ²¡æœ‰å¯åŠ¨åœ¨ 9092 ä¸Šï¼‰ï¼ŒSpring Boot ä¾ç„¶ä¼šè¿æ¥å¤±è´¥ã€‚

éªŒè¯ï¼š è¿è¡Œ netstat -ano | findstr :9092 æ£€æŸ¥ 9092 ç«¯å£æ˜¯å¦å¤„äº LISTENING çŠ¶æ€ï¼Œä¸” PID å¯¹åº”çš„æ˜¯ Java è¿›ç¨‹ï¼ˆæ‚¨çš„ Kafka Brokerï¼‰ã€‚

Kafka é…ç½®é”™è¯¯ï¼š æ£€æŸ¥æ‚¨ Kafka Broker çš„ server.properties æ–‡ä»¶ï¼Œç¡®ä¿ advertised.listenersï¼ˆå¦‚æœæœ‰é…ç½®ï¼‰æˆ– listeners ç¡®å®è¢«è®¾ç½®ä¸º PLAINTEXT://localhost:9092ã€‚

æ—¶åºå»¶è¿Ÿï¼š Kafka Broker éœ€è¦å‡ ç§’é’Ÿæ‰èƒ½å®Œå…¨å¯åŠ¨ã€‚è¯·ç¡®ä¿æ‚¨åœ¨çœ‹åˆ° Broker çª—å£åœæ­¢æ‰“å°å¯åŠ¨æ—¥å¿—å¹¶ç¨³å®šåï¼Œå†å¯åŠ¨ Spring Boot åº”ç”¨ã€‚

æ€»ç»“ï¼š è¯·ä¸¥æ ¼æŒ‰ç…§ ZooKeeperâ†’Kafka Brokerâ†’Spring Boot çš„é¡ºåºå¯åŠ¨ï¼Œå¹¶éªŒè¯ 9092 ç«¯å£çš„å®é™…å ç”¨æƒ…å†µã€‚

kafkaçš„server.propertiesä¸­æœ‰listeners=PLAINTEXT://:9092çš„é…ç½®ä¿¡æ¯ï¼Œä½†æ˜¯å‰æ–¹æœ‰#ç¬¦å·ï¼Œæ˜¯å±è”½æ²¡æ‰“å¼€çš„çŠ¶æ€ï¼Œæ‚¨çš„æ„æ€æ˜¯ï¼Œè¦æ”¾å¼€è¿™æ¡é…ç½®ä¿¡æ¯ä¹ˆï¼Ÿ

æ‚¨å¥½ï¼æ˜¯çš„ï¼Œæˆ‘çš„æ„æ€æ­£æ˜¯éœ€è¦æ‚¨æ”¾å¼€ï¼ˆå³å–æ¶ˆæ³¨é‡Šï¼‰è¿™æ¡é…ç½®ä¿¡æ¯ã€‚

ğŸš¨ ä¸ºä»€ä¹ˆè¦å–æ¶ˆæ³¨é‡Š listeners
åœ¨ Kafka çš„é…ç½®æ–‡ä»¶ server.properties ä¸­ï¼Œé…ç½®è¡Œçš„å‰æ–¹æœ‰ # ç¬¦å·ï¼Œè¡¨ç¤ºè¯¥è¡Œæ˜¯æ³¨é‡Šï¼ˆCommentsï¼‰ï¼ŒKafka åœ¨å¯åŠ¨æ—¶ä¼šå¿½ç•¥è¯¥è¡Œå†…å®¹ã€‚

å½“æ‚¨å–æ¶ˆå¯¹ listeners=PLAINTEXT://:9092 çš„æ³¨é‡Šï¼Œä½¿å…¶ç”Ÿæ•ˆåï¼Œå®ƒä¼šå‘Šè¯‰ Kafka Broker æ ¸å¿ƒçš„ä¸¤ä¸ªä¿¡æ¯ï¼š

ç›‘å¬ç«¯å£ (Port)ï¼š Broker åº”è¯¥åœ¨ 9092 ç«¯å£ä¸Šç­‰å¾…è¿æ¥ã€‚

ç›‘å¬åœ°å€ä¸åè®® (Address and Protocol)ï¼š

PLAINTEXTï¼š æŒ‡å®šä½¿ç”¨éåŠ å¯†çš„æ˜æ–‡åè®®è¿›è¡Œé€šä¿¡ï¼ˆæœ¬åœ°å¼€å‘ç¯å¢ƒçš„å¸¸ç”¨è®¾ç½®ï¼‰ã€‚

//:9092ï¼š è¿™é‡Œçš„çœç•¥ä¸»æœºå (//:) æ„å‘³ç€ Broker å°†ç›‘å¬æ‰€æœ‰å¯ç”¨çš„ç½‘ç»œæ¥å£ï¼ˆç­‰åŒäº 0.0.0.0:9092 æˆ– localhost:9092ï¼‰ã€‚

å¦‚æœæ²¡æœ‰è¿™æ¡é…ç½®ï¼ŒKafka å¯èƒ½æ— æ³•æ­£ç¡®åœ°çŸ¥é“å®ƒåº”è¯¥ç›‘å¬å“ªä¸ªç«¯å£æˆ–åœ°å€ï¼Œæˆ–è€…ä½¿ç”¨äº†ä¸ç¡®å®šçš„é»˜è®¤é…ç½®ï¼Œå¯¼è‡´æ‚¨çš„ Spring Boot åº”ç”¨ç¨‹åºæ— æ³•é€šè¿‡ localhost:9092 æ‰¾åˆ°å®ƒã€‚

ğŸ› ï¸ æ“ä½œæ­¥éª¤
è¯·ç¡®ä¿æ‚¨çš„ server.properties æ–‡ä»¶ä¸­è¿™æ¡é…ç½®æ˜¯æ´»è·ƒçš„ï¼Œä¸”æ ¼å¼æ­£ç¡®ï¼š

æ‰“å¼€æ‚¨çš„ Kafka é…ç½®æ–‡ä»¶å¤¹ (C:\kafka\config ä¸‹çš„ server.properties æˆ– server-test.properties æ–‡ä»¶)ã€‚

æ‰¾åˆ° listeners ç›¸å…³çš„è¡Œã€‚

åˆ é™¤è¡Œé¦–çš„ # ç¬¦å·ï¼š

Properties
# åŸæ¥å¯èƒ½æ˜¯è¿™æ · (è¢«æ³¨é‡Š)
# listeners=PLAINTEXT://:9092

# åº”è¯¥ä¿®æ”¹æˆè¿™æ · (ç”Ÿæ•ˆ)
listeners=PLAINTEXT://:9092 
ä¿å­˜æ–‡ä»¶ï¼Œå¹¶é‡æ–°å¯åŠ¨æ‚¨çš„ Kafka Broker æœåŠ¡ã€‚

åœ¨æ‚¨å®Œæˆä¸Šè¿°æ“ä½œå¹¶æˆåŠŸå¯åŠ¨ Kafka Broker åï¼Œå†æ¬¡å°è¯•å¯åŠ¨ Spring Boot æœåŠ¡ï¼Œåº”è¯¥å°±èƒ½è§£å†³æ‰¾ä¸åˆ° localhost:9092 çš„é—®é¢˜ã€‚

é…ç½®æ£€æŸ¥äº†ï¼Œä¹ŸæŒ‰ç…§æ‚¨æç¤ºçš„é¡ºåºå¯åŠ¨äº†æœåŠ¡ï¼Œä½†æ˜¯ï¼Œspringbootè¿˜æ˜¯å¯åŠ¨ä¸äº†ï¼Œæ§åˆ¶å°çš„æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ java.lang.IllegalStateException: This error handler cannot process 'SerializationException's directly; please consider configuring an 'ErrorHandlingDeserializer' in the value and/or key deserializer

at org.springframework.kafka.listener.DefaultErrorHandler.handleOtherException(DefaultErrorHandler.java:192) ~[spring-kafka-3.3.11.jar:3.3.11]

at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.handleConsumerException(KafkaMessageListenerContainer.java:1992) ~[spring-kafka-3.3.11.jar:3.3.11]

at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:1387) ~[spring-kafka-3.3.11.jar:3.3.11]

at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804) ~[na:na]

at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

Caused by: org.apache.kafka.common.errors.RecordDeserializationException: Error deserializing VALUE for partition transfer-requests-0 at offset 0. If needed, please seek past the record to continue consumption.

at org.apache.kafka.clients.consumer.internals.CompletedFetch.newRecordDeserializationException(CompletedFetch.java:346) ~[kafka-clients-3.8.1.jar:na]

at org.apache.kafka.clients.consumer.internals.CompletedFetch.parseRecord(CompletedFetch.java:330) ~[kafka-clients-3.8.1.jar:na]

at org.apache.kafka.clients.consumer.internals.CompletedFetch.fetchRecords(CompletedFetch.java:284) ~[kafka-clients-3.8.1.jar:na]

at org.apache.kafka.clients.consumer.internals.FetchCollector.fetchRecords(FetchCollector.java:168) ~[kafka-clients-3.8.1.jar:na]

at org.apache.kafka.clients.consumer.internals.FetchCollector.collectFetch(FetchCollector.java:134) ~[kafka-clients-3.8.1.jar:na]

at org.apache.kafka.clients.consumer.internals.Fetcher.collectFetch(Fetcher.java:145) ~[kafka-clients-3.8.1.jar:na]

at org.apache.kafka.clients.consumer.internals.LegacyKafkaConsumer.pollForFetches(LegacyKafkaConsumer.java:667) ~[kafka-clients-3.8.1.jar:na]

at org.apache.kafka.clients.consumer.internals.LegacyKafkaConsumer.poll(LegacyKafkaConsumer.java:618) ~[kafka-clients-3.8.1.jar:na]

at org.apache.kafka.clients.consumer.internals.LegacyKafkaConsumer.poll(LegacyKafkaConsumer.java:591) ~[kafka-clients-3.8.1.jar:na]

at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:874) ~[kafka-clients-3.8.1.jar:na]

at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.pollConsumer(KafkaMessageListenerContainer.java:1692) ~[spring-kafka-3.3.11.jar:3.3.11]

at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doPoll(KafkaMessageListenerContainer.java:1667) ~[spring-kafka-3.3.11.jar:3.3.11]

at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.pollAndInvoke(KafkaMessageListenerContainer.java:1445) ~[spring-kafka-3.3.11.jar:3.3.11]

at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:1335) ~[spring-kafka-3.3.11.jar:3.3.11]

... 2 common frames omitted

Caused by: java.lang.IllegalArgumentException: The class 'com.example.kafka_transfer.demo.dto.TransferRequest' is not in the trusted packages: [java.util, java.lang]. If you believe this class is safe to deserialize, please provide its name. If the serialization is only done by a trusted source, you can also enable trust all (*).

at org.springframework.kafka.support.mapping.DefaultJackson2JavaTypeMapper.getClassIdType(DefaultJackson2JavaTypeMapper.java:123) ~[spring-kafka-3.3.11.jar:3.3.11]

at org.springframework.kafka.support.mapping.DefaultJackson2JavaTypeMapper.toJavaType(DefaultJackson2JavaTypeMapper.java:97) ~[spring-kafka-3.3.11.jar:3.3.11]

at org.springframework.kafka.support.serializer.JsonDeserializer.deserialize(JsonDeserializer.java:587) ~[spring-kafka-3.3.11.jar:3.3.11]

at org.apache.kafka.common.serialization.Deserializer.deserialize(Deserializer.java:73) ~[kafka-clients-3.8.1.jar:na]

at org.apache.kafka.clients.consumer.internals.CompletedFetch.parseRecord(CompletedFetch.java:327) ~[kafka-clients-3.8.1.jar:na]

... 14 common frames omittedï¼Œè¯·å¸®æˆ‘åˆ†æåˆ†æé—®é¢˜åŸå› åœ¨å“ªé‡Œï¼Ÿ

æ‚¨å¥½ï¼æ„Ÿè°¢æ‚¨æä¾›å®Œæ•´çš„å †æ ˆä¿¡æ¯ã€‚è¿™ä¸ªé”™è¯¯æ˜¯éå¸¸å…¸å‹çš„ Spring Kafka ååºåˆ—åŒ–å®‰å…¨æœºåˆ¶å¼•å‘çš„é”™è¯¯ã€‚

æ ¸å¿ƒç»“è®ºï¼š æ‚¨çš„ Spring Boot åº”ç”¨å¯åŠ¨å¤±è´¥ï¼Œå¹¶ä¸æ˜¯å› ä¸ºæ‰¾ä¸åˆ° Kafka æœåŠ¡ï¼Œè€Œæ˜¯å› ä¸ºæ¶ˆè´¹è€…æ— æ³•å®‰å…¨åœ°ååºåˆ—åŒ– Topic ä¸­å·²å­˜åœ¨çš„æ¶ˆæ¯ã€‚

ğŸ” é”™è¯¯åŸå› åˆ†æï¼šä¸å¯ä¿¡çš„åŒ…å
é”™è¯¯ä¿¡æ¯æœ€æ·±å±‚çš„æ ¹æºæ¸…æ™°åœ°æŒ‡å‡ºäº†é—®é¢˜ï¼š

Java
Caused by: java.lang.IllegalArgumentException: The class 'com.example.kafka_transfer.demo.dto.TransferRequest' is not in the trusted packages: [java.util, java.lang]. If you believe this class is safe to deserialize, please provide its name. If the serialization is only done by a trusted source, you can also enable trust all (*).
    at org.springframework.kafka.support.mapping.DefaultJackson2JavaTypeMapper.getClassIdType(DefaultJackson2JavaTypeMapper.java:123) ~[spring-kafka-3.3.11.jar:3.3.11]
ğŸš¨ é—®é¢˜æ ¹æºï¼šJsonDeserializer çš„å®‰å…¨æœºåˆ¶
æ‚¨åœ¨ application.properties ä¸­å°†æ¶ˆè´¹è€…é…ç½®ä¸ºä½¿ç”¨ JsonDeserializerï¼š

Properties
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
ä¸ºäº†é˜²æ­¢è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE) æ¼æ´ï¼ˆè¿™æ˜¯ Jackson ååºåˆ—åŒ–ä¸­å¸¸è§çš„å®‰å…¨é£é™©ï¼‰ï¼ŒSpring Kafka é»˜è®¤åªå…è®¸ååºåˆ—åŒ–æ¥è‡ªå—ä¿¡ä»»åŒ…ï¼ˆå¦‚ java.util, java.langï¼‰ä¸­çš„ç±»ã€‚æ‚¨çš„ TransferRequest æ‰€åœ¨çš„åŒ…åï¼ˆå¯èƒ½æ˜¯ com.example.kafka_transfer.demo.dto æˆ–ç±»ä¼¼ï¼‰ä¸åœ¨è¿™ä¸ªé»˜è®¤ä¿¡ä»»åˆ—è¡¨ä¸­ã€‚

å½“æ‚¨çš„ Spring Boot åº”ç”¨å¯åŠ¨åï¼Œå®ƒè¿æ¥åˆ° Kafkaï¼Œå‘ç° transfer-requests-0 åˆ†åŒºçš„ Offset 0 ä¸Šæœ‰å†å²æ¶ˆæ¯ï¼Œå°è¯•æ‹‰å–å¹¶ååºåˆ—åŒ–æ—¶ï¼Œå®‰å…¨æœºåˆ¶è¢«è§¦å‘ï¼Œå¯¼è‡´åº”ç”¨å¯åŠ¨å¤±è´¥ã€‚

ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼šé…ç½®ä¿¡ä»»åŒ… (Trust Packages)
è§£å†³è¿™ä¸ªé—®é¢˜çš„æ ‡å‡†æ–¹æ³•æ˜¯åœ¨ application.properties ä¸­æ˜¾å¼åœ°å‘Šè¯‰ Spring Kafka å“ªäº›åŒ…æ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥è¿›è¡Œååºåˆ—åŒ–ã€‚

æ–¹æ¡ˆä¸€ï¼šä¿¡ä»»æ‚¨çš„ç‰¹å®š DTO åŒ…ï¼ˆæ¨èä¸”æœ€å®‰å…¨ï¼‰
è¯·åœ¨æ‚¨çš„ application.properties æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼Œå°†æ‚¨çš„ TransferRequest æ‰€åœ¨çš„ å®Œæ•´åŒ…è·¯å¾„ åŠ å…¥ä¿¡ä»»åˆ—è¡¨ã€‚

å‡è®¾æ‚¨çš„ TransferRequest ç±»ä½äº com.example.kafka_transfer.model åŒ…ä¸­ï¼š

Properties
# è§£å†³ååºåˆ—åŒ–å®‰å…¨é”™è¯¯
# å°†æ‚¨çš„ DTO æ‰€åœ¨çš„åŒ…è·¯å¾„åŠ å…¥ä¿¡ä»»åˆ—è¡¨
spring.kafka.consumer.properties.spring.json.trusted.packages=com.example.kafka_transfer.model,java.util,java.lang
æ¸©é¦¨æç¤ºï¼š å¦‚æœæ‚¨çš„ TransferRequest åœ¨å¤šä¸ªå­åŒ…ä¸­ï¼Œå¯ä»¥å°†èŒƒå›´è®¾ç½®å¾—å¤§ä¸€äº›ï¼Œä¾‹å¦‚ com.example.kafka_transfer.*ã€‚

æ–¹æ¡ˆäºŒï¼šä¿¡ä»»æ‰€æœ‰åŒ…ï¼ˆä¸æ¨èï¼Œä½†å¯ç”¨äºå¿«é€Ÿæµ‹è¯•ï¼‰
å¦‚æœæ‚¨ä¸æƒ³ä¸€ä¸ªä¸ªæŒ‡å®šåŒ…åï¼Œå¯ä»¥ä½¿ç”¨ * æ¥ä¿¡ä»»æ‰€æœ‰åŒ…ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¼šé™ä½å®‰å…¨æ€§ï¼Œä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚

Properties
spring.kafka.consumer.properties.spring.json.trusted.packages=*
ğŸ’¡ è¾…åŠ©æ“ä½œï¼šæ¸…é™¤ Topic å†å²æ¶ˆæ¯ (å¯é€‰)
å¦‚æœæ‚¨çš„ Kafka Topic (transfer-requests) ä¸­å­˜åœ¨æ ¼å¼é”™è¯¯æˆ–æ—§ç‰ˆæœ¬æ ¼å¼çš„å†å²æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®æ˜¯å¯¼è‡´ååºåˆ—åŒ–å¤±è´¥çš„æ ¹æœ¬åŸå› ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥é€‰æ‹©æ¸…é™¤ Topic çš„å†å²æ¶ˆæ¯ï¼Œè®©æ¶ˆè´¹è€…ä»ä¸€ä¸ªå¹²å‡€çš„çŠ¶æ€å¼€å§‹ã€‚

è¯·æ³¨æ„ï¼šè¿™ä¸ªæ“ä½œä¼šåˆ é™¤ Topic ä¸­æ‰€æœ‰æ•°æ®ã€‚

åœæ­¢ Spring Boot å’Œ Kafka Brokerã€‚

åˆ é™¤ Kafka æ—¥å¿—æ–‡ä»¶ï¼š åˆ é™¤ C:\kafka\kafka-logs ç›®å½•ä¸‹ä¸ transfer-requests ç›¸å…³çš„æ–‡ä»¶å¤¹ã€‚

é‡æ–°å¯åŠ¨ Kafka Brokerã€‚

é‡æ–°å¯åŠ¨ Spring Bootã€‚

è¯·å…ˆå°è¯• æ–¹æ¡ˆä¸€ ä¿®æ”¹é…ç½®ï¼Œè¿™æ˜¯æœ€ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚ åªæœ‰åœ¨ä¿®æ”¹é…ç½®åä»æ— æ³•å¯åŠ¨æ—¶ï¼Œå†è€ƒè™‘æ¸…é™¤å†å²æ•°æ®ã€‚






































